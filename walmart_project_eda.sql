create database walmart_project;

use walmart_project;

SELECT * FROM WALMART_SALES;

-- Which Branch and City generate the highest total revenue and profit?
SELECT BRANCH,CITY, round(SUM(TOTAL),2)as total_revenue	, round(SUM(PROFIT),2)
AS total_profit FROM WALMART_SALES GROUP BY 1,2;

-- What is the revenue contribution (%) of each product category?
SELECT CATEGORY, ROUND(SUM(TOTAL),2) AS CATEGORY_TOTAL,
SUM(TOTAL)/(SELECT SUM(TOTAL) FROM WALMART_SALES)*100
FROM WALMART_SALES
GROUP BY CATEGORY;

-- Average Order Value (AOV) by Branch
SELECT BRANCH, ROUND(AVG(TOTAL),2)AS average_order_value FROM WALMART_SALES
GROUP BY BRANCH;

-- Monthly revenue trend
SELECT YEAR, MONTH_NAME, ROUND(SUM(TOTAL),2) AS total_sales FROM WALMART_SALES
GROUP BY 1,MONTH,MONTH_NAME
ORDER BY 1,MONTH, MONTH_NAME ASC;

-- Cost vs revenue by category
SELECT CATEGORY, ROUND(SUM(COST),2) AS total_cost, ROUND(SUM(TOTAL),2) AS total_revenue, SUM(QUANTITY) AS quantity_sold,ROUND(SUM(PROFIT),2) AS gross_profit
FROM WALMART_SALES GROUP BY CATEGORY;

--  Peak sales hours
SELECT HOUR, SUM(TOTAL) FROM WALMART_SALES
GROUP BY HOUR
ORDER BY 1;

-- Quantity sold by hour
SELECT HOUR, SUM(QUANTITY)AS total_quantity_sold FROM WALMART_SALES
GROUP BY HOUR
ORDER BY 1;

-- WEEKDAY VS REVENUE
SELECT WEEK, ROUND(AVG(TOTAL),2)AS AVERGAE_revenue
FROM WALMART_SALES 
GROUP BY WEEK
;

-- Revenue & profit by payment method
SELECT PAYMENT_METHOD, ROUND(SUM(TOTAL),2) AS total_revenue, 
ROUND(SUM(PROFIT),2) AS total_profit FROM WALMART_SALES
GROUP BY PAYMENT_METHOD;

-- AOV by payment method
SELECT PAYMENT_METHOD, ROUND(AVG(TOTAL),2) AS total_revenue
FROM WALMART_SALES
GROUP BY PAYMENT_METHOD;

-- Ratings by payment method
SELECT PAYMENT_METHOD, ROUND(AVG(RATING),2)AS average_ratings
FROM WALMART_SALES
GROUP BY PAYMENT_METHOD;

-- ratings by category
SELECT CATEGORY, ROUND(AVG(RATING),2)AS average_ratings
FROM WALMART_SALES
GROUP BY CATEGORY;

-- Profit by rating group
SELECT RATING_GROUP, ROUND(SUM(PROFIT),2) AS total_profit
FROM WALMART_SALES
GROUP BY RATING_GROUP;

-- REVENUE BY RATING
SELECT RATING_GROUP, ROUND(SUM(TOTAL),2) AS total_revenue
FROM WALMART_SALES
GROUP BY RATING_GROUP;

SELECT CATEGORY, ROUND(SUM(PROFIT),2) AS total_profit FROM WALMART_SALES
GROUP BY CATEGORY
ORDER BY SUM(PROFIT) DESC;

SELECT CATEGORY, ROUND(SUM(total),2) as total_revenue
FROM WALMART_SALES GROUP BY CATEGORY
HAVING SUM(TOTAL) > (SELECT AVG(TOTAL)AS average FROM WALMART_SALES);

SELECT CATEGORY, AVG(RATING)AS avg_rating FROM WALMART_SALES
GROUP BY CATEGORY
ORDER BY 2 DESC;

-- Total sales by year
SELECT YEAR, SUM(TOTAL) FROM WALMART_SALES
GROUP BY YEAR
ORDER BY YEAR ASC;

-- Monthly sales trend
SELECT MONTH_NAME, SUM(TOTAL) FROM WALMART_SALES
GROUP BY MONTH, MONTH_NAME
ORDER BY MONTH ASC;

-- Weekly sales pattern
SELECT DISTINCT(WEEK),ROUND(SUM(TOTAL),2) FROM WALMART_SALES
GROUP BY WEEK;

-- Sales by branch
SELECT DISTINCT(BRANCH), SUM(TOTAL) AS REVENUE FROM WALMART_SALES
GROUP BY BRANCH
ORDER BY 2 DESC;

-- Profit by city
SELECT CITY, SUM(PROFIT) FROM WALMART_SALES
GROUP BY CITY;

-- Best performing branch by profit margin
SELECT BRANCH, ROUND(AVG(PROFIT_MARGIN),2) FROM WALMART_SALES
GROUP BY BRANCH
ORDER BY 2 DESC;

-- Total sales by product category
SELECT CATEGORY, ROUND(SUM(TOTAL),2) AS REVENUE, ROUND(SUM(PROFIT),2) AS TOTAL_PROFIT
FROM WALMART_SALES
GROUP BY CATEGORY
ORDER BY 2,3 DESC;

-- Most sold category by quantity
SELECT CATEGORY , SUM(QUANTITY)AS QUANTITY_SOLD FROM WALMART_SALES
GROUP BY CATEGORY
ORDER BY 2 DESC;

-- Average unit price per category
SELECT CATEGORY, ROUND(AVG(UNIT_PRICE),2) FROM WALMART_SALES
GROUP BY CATEGORY;

-- Most preferred payment method
SELECT PAYMENT_METHOD, COUNT(*) AS COUNT FROM WALMART_SALES 
GROUP BY PAYMENT_METHOD;

-- Payment method contribution to total sales
SELECT PAYMENT_METHOD, ROUND(SUM(TOTAL),2) AS TOTAL_REVENUE
FROM WALMART_SALES
GROUP BY PAYMENT_METHOD
ORDER BY 2 DESC;

-- Average rating by category
SELECT CATEGORY, ROUND(AVG(RATING),2) AS AVG_RATING FROM WALMART_SALES
GROUP BY CATEGORY
ORDER BY 2 DESC;

-- Rating distribution
SELECT RATING_GROUP, COUNT(*)AS COUNTS FROM WALMART_SALES
GROUP BY RATING_GROUP 
ORDER BY 2 DESC;

-- Relationship between rating and profit
SELECT RATING_GROUP, AVG(PROFIT) FROM WALMART_SALES
GROUP BY RATING_GROUP
ORDER BY 2 DESC;

-- Total cost vs total profit
SELECT SUM(COST) AS TOTAL_COST,
SUM(TOTAL) AS REVENUE,
SUM(PROFIT) AS TOTAL_PROFIT 
FROM WALMART_SALES;

-- Most profitable category
SELECT CATEGORY, SUM(PROFIT)AS PROFIT FROM WALMART_SALES
GROUP BY CATEGORY
ORDER BY 2 DESC
LIMIT 1;

-- Profit margin by category
SELECT CATEGORY, AVG(PROFIT_MARGIN) FROM WALMART_SALES
GROUP BY CATEGORY
ORDER BY 2 DESC;

-- Peak sales hour by branch
WITH CTE1 AS(
SELECT BRANCH, HOUR, COUNT(*) AS COUNT,ROW_NUMBER() OVER (partition by BRANCH ORDER BY COUNT(*) DESC)AS ROW_NUM
 FROM WALMART_SALES GROUP BY 
 BRANCH, HOUR ORDER BY BRANCH, COUNT(*) DESC
 )
 
 SELECT BRANCH, HOUR, COUNT FROM CTE1 WHERE ROW_NUM=1;
 
 -- Top 3 categories by revenue per city
WITH CTE1 AS(
 SELECT CATEGORY,CITY, ROUND(SUM(TOTAL),2) AS TOTAL_REVENUE , ROW_NUMBER() OVER (partition by CITY ORDER BY SUM(TOTAL) DESC) AS ROW_NUM FROM WALMART_SALES
 GROUP BY CATEGORY, CITY
)

SELECT CATEGORY, CITY , TOTAL_REVENUE FROM CTE1 WHERE ROW_NUM <=3 ORDER BY CITY;

-- Which categories contribute 80% of total revenue? 
WITH CTE1 AS(
SELECT CATEGORY, SUM(TOTAL) AS TOTAL_CAT_REVENUE,(SELECT SUM(TOTAL) FROM WALMART_SALES)AS TOTAL_REVENUE FROM WALMART_SALES
GROUP BY CATEGORY)

SELECT CATEGORY, ROUND(TOTAL_CAT_REVENUE,2), ROUND((TOTAL_CAT_REVENUE/TOTAL_REVENUE)*100,2) AS PERCENTAGE FROM CTE1
ORDER BY 2 DESC;

-- Month-over-Month (MoM) sales growth
WITH CTE1 AS (
SELECT YEAR, MONTH, MONTH_NAME, SUM(TOTAL) AS MONTHLY_REVENUE
FROM WALMART_SALES
GROUP BY YEAR, MONTH, MONTH_NAME
ORDER BY YEAR, MONTH
)
SELECT YEAR, MONTH_NAME, MONTHLY_REVENUE, LAG(MONTHLY_REVENUE) OVER (ORDER BY YEAR,MONTH) AS PREV_MONTH_REV,
100*((MONTHLY_REVENUE - LAG(MONTHLY_REVENUE) OVER (ORDER BY YEAR,MONTH)) / LAG(MONTHLY_REVENUE) OVER (ORDER BY YEAR,MONTH)) AS GROWTH_PERCENT
FROM CTE1;


-- Year-over-Year (YoY) sales growth
WITH CTE1 AS (
SELECT YEAR, SUM(TOTAL) AS TOTAL_REVENUE
FROM WALMART_SALES
GROUP BY YEAR
)

SELECT YEAR, TOTAL_REVENUE, ROUND(LAG(TOTAL_REVENUE) OVER (ORDER BY YEAR),2)AS PREV_YEAR_REV,
ROUND(100* ((TOTAL_REVENUE - LAG(TOTAL_REVENUE) OVER (ORDER BY YEAR)) / LAG(TOTAL_REVENUE) OVER (ORDER BY YEAR)),2) AS YOY_GROWTH
FROM CTE1;

-- Rank branches by profit efficiency
WITH CTE1 AS (
SELECT BRANCH,ROUND(SUM(PROFIT),2) AS BRANCH_PROFIT,
ROUND(SUM(TOTAL),2) AS TOTAL_REVENUE
FROM WALMART_SALES
GROUP BY BRANCH
)
SELECT BRANCH, BRANCH_PROFIT, TOTAL_REVENUE, 
ROUND((BRANCH_PROFIT/TOTAL_REVENUE)*100,2) AS PROFIT_EFFICIENCY
FROM CTE1
ORDER BY BRANCH;

-- Do higher ratings actually generate more profit?
SELECT RATING_GROUP ,COUNT(*) AS COUNT_OF_TRANSACTIONS, ROUND(SUM(TOTAL),2) AS TOTAL_REVENUE, ROUND(SUM(PROFIT),2) AS TOTAL_PROFIT
FROM WALMART_SALES
GROUP BY 1
ORDER BY 4 DESC;

-- Identify peak and off-peak months
SELECT MONTH_NAME , COUNT(*) AS COUNT_OF_TRANSACTIONS
FROM WALMART_SALES
GROUP BY 1,MONTH
ORDER BY 2 DESC;

-- Weekend vs weekday sales performance
SELECT 
CASE WHEN WEEK IN ("MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY") THEN "WEEK_DAYS"
ELSE "WEEK_END"
END AS WEEK_WISE, ROUND(SUM(TOTAL),2) AS TOTAL_REVENUE, COUNT(*) AS TRANSACTIONS, 
ROUND(AVG(TOTAL),2) AS AVERAGE, ROUND(SUM(PROFIT),2) AS PROFIT
FROM WALMART_SALES
GROUP BY WEEK_WISE;

-- Identify unusually high-value transactions
WITH CTE1 AS(
SELECT CATEGORY, SUM(TOTAL) AS TOTAL_REVENUE, AVG(TOTAL) AS AVERAGE_REVENUE
FROM WALMART_SALES
GROUP BY CATEGORY
)
SELECT CATEGORY, TOTAL_REVENUE 
FROM CTE1
WHERE TOTAL_REVENUE > AVERAGE_REVENUE;

-- Categories with high sales but low profit margins
SELECT CATEGORY, SUM(QUANTITY) QUANTITIES_SOLD, AVG(PROFIT_MARGIN) AS AVG_PROFIT_MARGIN
FROM WALMART_SALES
GROUP BY 1
HAVING AVG_PROFIT_MARGIN < (SELECT AVG(PROFIT_MARGIN) FROM WALMART_SALES );

